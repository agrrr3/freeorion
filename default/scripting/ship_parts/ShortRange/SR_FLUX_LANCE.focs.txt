Part
    name = "SR_FLUX_LANCE"
    description = "SR_FLUX_LANCE_DESC"
    class = ShortRange
    damage = 1
    shots = 3
    NoDefaultCapacityEffect
    totalShipDamageEstimation = 1.0 //
     // Source.Attack  // FIXME triggers an endless loop
     //Source.Structure // doesnt seem to work
     //Value(Source.Structure) // doesnt seem to work
     * [[SHIP_WEAPON_DAMAGE_FACTOR]]
     * 3.0 // XXX get rid of hardcoded shots
     // (ShipPartMeter part = ThisPart meter = SecondaryStat object = Source.ID) // not sure if ThisPart works
     
     * NamedRealLookup name = "NUM_REAL_COMBAT_ROUNDS_IN_CLOSE_TARGETING_RANGE"
    combatTargets = And [
        (CombatBout >= NamedIntegerLookup name = "FIRST_COMBAT_ROUND_IN_CLOSE_TARGETING_RANGE")
        [[COMBAT_TARGETS_VISIBLE_ENEMY]]
        Or [
           [[COMBAT_TARGETS_NOT_DESTROYED_SHIP]]
           [[COMBAT_TARGETS_PLANET_WITH_DEFENSE]]
        ]
    ]
    mountableSlotTypes = External
    buildcost = 20 * [[FLEET_UPKEEP_MULTIPLICATOR]] * [[SHIP_PART_COST_MULTIPLIER]]
    buildtime = 1
    tags = [ "PEDIA_PC_DIRECT_WEAPON" ]
    location = OwnedBy empire = Source.Owner
    effectsgroups =
        [[WEAPON_BASE_DEFAULT_EFFECTS(SR_WEAPON_0_1)]]
    icon = "icons/ship_parts/flak.png"

#include "shortrange.macros"
#include "/scripting/common/misc.macros"
#include "/scripting/common/upkeep.macros"
#include "/scripting/ship_parts/targeting.macros"

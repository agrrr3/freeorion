#!/bin/sh

set -e

ROOT=/usr/share/games/freeorion
cd ${ROOT}
printf 'CWD: '
pwd

DATAPATH="--resource-dir /usr/share/games/freeorion/default"

SAVEFILE=`ls -t /var/lib/freeorion/save/FO0001/*.mps | head -n1`

if [ -f "${SAVEFILE}" ];
then
    SAVEARGS=--load "${SAVEFILE}"
else
    SAVEARGS=-q
fi

LD_LIBRARY_PATH="/usr/lib/freeorion:${LD_LIBRARY_PATH}" \
/usr/lib/freeorion/freeoriond --network.server.turn-timeout.first-turn-time "$(date -u "+%Y-%m-%d 00:00:00" -d "+2 days")"  ${DATAPATH} ${SAVEARGS} "$@"
EXITST=$?
if [ ${EXITST} -ne 0 ];
then
  # do something on fail
fi
exit ${EXITST}
